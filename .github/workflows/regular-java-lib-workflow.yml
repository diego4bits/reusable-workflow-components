name: Regular Java Library Workflow
description: > 

on: 
  workflow_dispatch:
  workflow_call:
    inputs:
      # JFrog CLI Configuration
      jf-url:
        description: 'JFrog URL'
        required: true
        type: string
      # jf-server-id-resolve:
      #   description: 'Server ID for JFrog CLI configuration'
      #   required: false
      #   default: 'my-server'
      #   type: string
      jf-repo-resolve-releases:
        description: 'Repository for resolving releases'
        required: false
        default: 'maven'
        type: string
      jf-repo-resolve-snapshots:
        description: 'Repository for resolving snapshots'
        required: false
        default: 'maven'
        type: string
      jf-upload-repo-path:
        description: 'Path of the JFrog repository where the artifact will be uploaded'
        required: false # false meanwhile for testing purposes
        type: string
      # Java Setup Configuration
      java-distribution:
        description: 'Java distribution to use (e.g., temurin)'
        required: false
        default: 'temurin'
        type: string
      java-version: 
        description: 'Java version to use (e.g., 17)'
        required: false
        default: '17'
        type: string
      # SonarQube Configuration
      sonar-project-key:
        description: 'SonarQube Project Key'
        required: true
        type: string
      sonar-project-name: 
        description: 'SonarQube Project Name'
        required: true
        type: string
    secrets:
      jf-access-token:
        description: 'JFrog Access Token'
        required: true
      sonar-token:
        description: 'SonarQube Token'
        required: true 
      sonar-host-url:
        description: 'SonarQube URL'
        required: true
        type: string
      sonar-organization:
        description: 'SonarQube Organization'
        required: true 
        type: string
        


jobs:
  main-job:
    runs-on: ubuntu-latest

    steps:
    # Setup steps for the workflow
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # fetch-depth: 0 es crucial para que SonarQube pueda analizar correctamente
          # el código nuevo, especialmente en Pull Requests (aunque con workflow_dispatch es menos crítico para PRs).
          fetch-depth: 0

      - name: Setup JDK
        uses: diego4bits/reusable-workflow-components/.github/actions/setup-jdk@main
        with:
          java-distribution: ${{ inputs.java-distribution }}
          java-version: ${{ inputs.java-version }}

      - name: Setup JFrog CLI - Auth Token
        uses: diego4bits/reusable-workflow-components/.github/actions/setup-and-config-jfrog@main
        with:
          jf-url: ${{ inputs.jf-url }}
          jf-access-token: ${{ secrets.jf-access-token }}
          #jf-server-id-resolve: ${{ inputs.jf-server-id-resolve }}
          jf-repo-resolve-releases: ${{ inputs.jf-repo-resolve-releases }}
          jf-repo-resolve-snapshots: ${{ inputs.jf-repo-resolve-snapshots }}

    # --------------------------------------------------------------------------------------------------------     
    # "Actual" steps of the workflow - Commented out for now only to show the scaffolding of the workflow.
    # --------------------------------------------------------------------------------------------------------   
      # ✅ ✅ ✅  Working ✅ ✅ ✅  (Only commented out for testing purposes to save time in execution)
      # - name: Build & Test Using Maven & JFrog
      #   uses: diego4bits/reusable-workflow-components/.github/actions/build-and-test-mvn@main
      # ✅ ✅ ✅  Working ✅ ✅ ✅  (Only commented out for testing purposes to save time in execution)
      # REMEMBER THE JAVA_HOME ERROR
      # - name: Dependecy Check Scan
      #   uses: diego4bits/reusable-workflow-components/.github/actions/dependency-check@main
      #   with:
      #     scan-args: |
      #       --disableRetireJS
      #       --scan "**/*.java"
      #       --format HTML

      - name: SonarQube Scan
        uses: ./.github/actions/sonarqube-scan@v1
        with:
          sonar-project-key: ${{ inputs.sonar-project-key }}
          sonar-project-name: ${{ inputs.sonar-project-name }}
          sonar-organization: ${{ secrets.sonar-organization }}
          sonar-host-url: ${{ secrets.sonar-host-url }}
          sonar-token: ${{ secrets.sonar-token }}



      # Just a Place holder for the Checkmarx Scan step
      # - name: Checkmarx Scan
      #   uses: java/libraries/actions/checkmarx-scan@v1
      # Just a Place holder for the Semantic Versioning Scan step
      #- name: Semantic Versioning
      #  uses: java/libraries/actions/semantic-versioning@v1
      # Just a Place holder for the Build & Test Tag step
      # - name: Build & Test Tag
      # Just a Place holder for the Upload Artifacts To JFrog step
      # - name : Upload Artifacts To JFrog
      #   uses: ./.github/libraries/actions/upload-to-jfrog-jar-pom@v1

        
  
